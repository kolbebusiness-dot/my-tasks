<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Task Ranks">
    <title>Task Rank System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: 
                repeating-linear-gradient(
                    45deg,
                    #3d4a3e,
                    #3d4a3e 10px,
                    #4a5a4b 10px,
                    #4a5a4b 20px,
                    #5a6b5c 20px,
                    #5a6b5c 30px,
                    #4a5548 30px,
                    #4a5548 40px
                );
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(42, 48, 42, 0.95);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            border: 3px solid #5a6b5c;
        }
        h1 {
            text-align: center;
            color: #d4af37;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        .rank-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #3d4a3e 0%, #5a6b5c 100%);
            border-radius: 8px;
            margin-bottom: 30px;
            color: #d4af37;
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            border: 2px solid #7a8b7c;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .rank-progress {
            font-size: 14px;
            opacity: 0.9;
            color: #c4c4c4;
        }
        .rank-insignia {
            width: 80px;
            height: 80px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.8));
        }
        .input-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        .input-row {
            display: flex;
            gap: 10px;
        }
        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 2px solid #5a6b5c;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
            min-width: 0;
            background: rgba(240, 240, 240, 0.95);
        }
        input[type="text"]:focus {
            outline: none;
            border-color: #d4af37;
        }
        select {
            padding: 12px;
            border: 2px solid #5a6b5c;
            border-radius: 6px;
            font-size: 16px;
            background: rgba(240, 240, 240, 0.95);
            cursor: pointer;
            width: 100%;
        }
        button {
            padding: 12px 24px;
            background: #5a6b5c;
            color: #f4f4f4;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            white-space: nowrap;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        button:hover {
            background: #4a5a4b;
        }
        .reset-btn {
            background: #8b4513;
            margin-top: 10px;
            width: 100%;
        }
        .reset-btn:hover {
            background: #6b3410;
        }
        .reset-progress-btn {
            background: #cd853f;
            margin-top: 10px;
            width: 100%;
        }
        .reset-progress-btn:hover {
            background: #b8732e;
        }
        .bracket-section {
            margin-bottom: 25px;
        }
        .bracket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: linear-gradient(135deg, #4a5548 0%, #5a6b5c 100%);
            border-radius: 6px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #d4af37;
            gap: 10px;
            border: 2px solid #3d4a3e;
        }
        .bracket-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .bracket-insignia {
            width: 40px;
            height: 40px;
            filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.8));
        }
        .bracket-progress {
            font-size: 14px;
            color: #c4c4c4;
        }
        .task-list {
            list-style: none;
        }
        .task-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(90, 107, 92, 0.3);
            border-radius: 6px;
            margin-bottom: 8px;
            transition: all 0.3s;
            position: relative;
            border: 1px solid #5a6b5c;
        }
        .task-item.completed {
            opacity: 0.5;
            text-decoration: line-through;
        }
        .task-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            flex-shrink: 0;
            accent-color: #d4af37;
        }
        .task-text {
            flex: 1;
            color: #e4e4e4;
        }
        .delete-btn {
            background: #8b4513;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
            flex-shrink: 0;
            text-transform: uppercase;
            font-weight: bold;
        }
        .delete-btn:hover {
            background: #6b3410;
        }
        .edit-btn, .move-btn {
            background: #5a6b5c;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 5px;
            flex-shrink: 0;
            text-transform: uppercase;
            font-weight: bold;
        }
        .edit-btn:hover, .move-btn:hover {
            background: #4a5a4b;
        }
        .task-controls {
            display: flex;
            gap: 5px;
            flex-shrink: 0;
        }
        .arrow-btn {
            background: #5a6b5c;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        .arrow-btn:hover {
            background: #4a5a4b;
        }
        .arrow-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal-content {
            background: #2a302a;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            border: 3px solid #5a6b5c;
        }
        .modal-content h3 {
            color: #d4af37;
            margin-bottom: 20px;
            text-align: center;
        }
        .modal-content input,
        .modal-content select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #5a6b5c;
            border-radius: 6px;
            font-size: 16px;
            background: rgba(240, 240, 240, 0.95);
        }
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        .modal-buttons button {
            padding: 10px 20px;
        }
        .rank-up-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(42, 48, 42, 0.98);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s;
        }
        .rank-up-content {
            text-align: center;
            color: #d4af37;
            animation: scaleIn 0.5s;
        }
        .rank-up-content h2 {
            font-size: 48px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 3px;
            color: #d4af37;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
        }
        .rank-up-content p {
            font-size: 24px;
            margin-bottom: 30px;
            color: #e4e4e4;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.5); }
            to { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Task Rank System</h1>
        
        <div class="rank-display" id="rankDisplay">
            Recruit
            <div class="rank-progress" id="rankProgress">0/3 brackets completed</div>
        </div>

        <div class="input-section">
            <div class="input-row">
                <input type="text" id="taskInput" placeholder="Enter task...">
                <button onclick="addTask()">Add</button>
            </div>
            <select id="bracketSelect"></select>
            <button class="reset-progress-btn" onclick="resetProgress()">Reset Progress</button>
            <button class="reset-btn" onclick="resetAll()">Reset All Data</button>
        </div>

        <div id="bracketsContainer"></div>
    </div>

    <div class="rank-up-animation" id="rankUpAnimation">
        <div class="rank-up-content">
            <div id="newRankInsignia"></div>
            <h2 id="newRankText">RANK UP!</h2>
            <p id="newRankName"></p>
            <button onclick="closeRankUp()">Continue</button>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <h3>Edit Task</h3>
            <input type="text" id="editInput" placeholder="Edit task text...">
            <div class="modal-buttons">
                <button onclick="cancelEdit()">Cancel</button>
                <button onclick="saveEdit()">Save</button>
            </div>
        </div>
    </div>

    <!-- Move Modal -->
    <div class="modal" id="moveModal">
        <div class="modal-content">
            <h3>Move Task To</h3>
            <select id="moveBracketSelect"></select>
            <div class="modal-buttons">
                <button onclick="cancelMove()">Cancel</button>
                <button onclick="saveMove()">Move</button>
            </div>
        </div>
    </div>

    <script>
        const ranks = [
            { name: 'No Insignia', stripes: 0 },
            { name: 'Private', stripes: 1 },
            { name: 'Private First Class', stripes: 1, arc: true },
            { name: 'Specialist', stripes: 0, eagle: true },
            { name: 'Corporal', stripes: 2 },
            { name: 'Sergeant', stripes: 3 },
            { name: 'Staff Sergeant', stripes: 3, rockers: 1 },
            { name: 'Sergeant First Class', stripes: 3, rockers: 2 },
            { name: 'Master Sergeant', stripes: 3, rockers: 3 },
            { name: 'First Sergeant', stripes: 3, rockers: 3, diamond: true },
            { name: 'Sergeant Major', stripes: 3, rockers: 3, star: true },
            { name: 'Command Sergeant Major', stripes: 3, rockers: 3, star: true, wreath: true },
            { name: 'Sergeant Major of the Army', stripes: 3, rockers: 3, star: true, wreath: true, seal: true }
        ];
        let brackets = [
            { name: 'Bracket 1', rank: 1, tasks: [], completed: false },
            { name: 'Bracket 2', rank: 2, tasks: [], completed: false },
            { name: 'Bracket 3', rank: 3, tasks: [], completed: false },
            { name: 'Bracket 4', rank: 4, tasks: [], completed: false },
            { name: 'Bracket 5', rank: 5, tasks: [], completed: false },
            { name: 'Bracket 6', rank: 6, tasks: [], completed: false },
            { name: 'Bracket 7', rank: 7, tasks: [], completed: false },
            { name: 'Bracket 8', rank: 8, tasks: [], completed: false },
            { name: 'Bracket 9', rank: 9, tasks: [], completed: false },
            { name: 'Bracket 10', rank: 10, tasks: [], completed: false },
            { name: 'Bracket 11', rank: 11, tasks: [], completed: false },
            { name: 'Bracket 12', rank: 12, tasks: [], completed: false }
        ];
        let currentRank = 0;
        let editingTask = null;
        let movingTask = null;

        function saveData() {
            const data = {
                brackets: brackets,
                currentRank: currentRank
            };
            localStorage.setItem('taskRanksData', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('taskRanksData');
            if (saved) {
                const data = JSON.parse(saved);
                brackets = data.brackets;
                currentRank = data.currentRank;
            }
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This will uncheck all tasks and reset your rank to No Insignia, but keep all your tasks.')) {
                // Uncheck all tasks and mark brackets as incomplete
                brackets.forEach(bracket => {
                    bracket.tasks.forEach(task => {
                        task.completed = false;
                    });
                    bracket.completed = false;
                });
                
                // Reset rank to No Insignia
                currentRank = 0;
                
                saveData();
                render();
                alert('Progress has been reset! All tasks remain but are now unchecked.');
            }
        }

        function resetAll() {
            if (confirm('Are you sure you want to delete ALL tasks and reset your rank to No Insignia? This cannot be undone.')) {
                localStorage.removeItem('taskRanksData');
                
                // Reset to initial state
                brackets = [
                    { name: 'Bracket 1', rank: 1, tasks: [], completed: false },
                    { name: 'Bracket 2', rank: 2, tasks: [], completed: false },
                    { name: 'Bracket 3', rank: 3, tasks: [], completed: false },
                    { name: 'Bracket 4', rank: 4, tasks: [], completed: false },
                    { name: 'Bracket 5', rank: 5, tasks: [], completed: false },
                    { name: 'Bracket 6', rank: 6, tasks: [], completed: false },
                    { name: 'Bracket 7', rank: 7, tasks: [], completed: false },
                    { name: 'Bracket 8', rank: 8, tasks: [], completed: false },
                    { name: 'Bracket 9', rank: 9, tasks: [], completed: false },
                    { name: 'Bracket 10', rank: 10, tasks: [], completed: false },
                    { name: 'Bracket 11', rank: 11, tasks: [], completed: false },
                    { name: 'Bracket 12', rank: 12, tasks: [], completed: false }
                ];
                currentRank = 0;
                
                render();
                alert('All data has been reset!');
            }
        }

        function drawRankInsignia(rank, size = 80) {
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', size.toString());
            svg.setAttribute('height', size.toString());
            svg.setAttribute('viewBox', '0 0 80 80');
            
            if (size === 80) {
                svg.classList.add('rank-insignia');
            } else if (size === 40) {
                svg.classList.add('bracket-insignia');
            } else if (size === 30) {
                svg.classList.add('small-insignia');
            }

            if (rank.name === 'No Insignia') {
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', '40');
                text.setAttribute('y', '45');
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', '#d4af37');
                text.setAttribute('font-size', size > 50 ? '10' : '7');
                text.setAttribute('font-weight', 'bold');
                text.textContent = 'NO INSIGNIA';
                svg.appendChild(text);
                return svg;
            }

            if (rank.eagle) {
                // Draw eagle shield
                const shield = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                shield.setAttribute('d', 'M 40,20 L 30,25 L 25,40 L 30,55 L 40,60 L 50,55 L 55,40 L 50,25 Z');
                shield.setAttribute('fill', '#1e3c72');
                shield.setAttribute('stroke', '#f4b942');
                shield.setAttribute('stroke-width', '2');
                svg.appendChild(shield);

                // Draw simplified eagle
                const eagle = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                eagle.setAttribute('d', 'M 32,35 L 40,30 L 48,35 M 35,38 L 40,42 L 45,38 M 30,40 L 35,42 M 50,40 L 45,42');
                eagle.setAttribute('stroke', '#f4b942');
                eagle.setAttribute('stroke-width', '2');
                eagle.setAttribute('fill', 'none');
                svg.appendChild(eagle);
                
                return svg;
            }

            const baseY = 65;
            const stripeHeight = 8;
            const stripeSpacing = 3;

            if (rank.stripes > 0) {
                for (let i = 0; i < rank.stripes; i++) {
                    const y = baseY - (i * (stripeHeight + stripeSpacing));
                    const stripe = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                    const points = `20,${y} 40,${y-12} 60,${y} 60,${y+stripeHeight} 40,${y-12+stripeHeight} 20,${y+stripeHeight}`;
                    stripe.setAttribute('points', points);
                    stripe.setAttribute('fill', '#f4b942');
                    stripe.setAttribute('stroke', '#1e3c72');
                    stripe.setAttribute('stroke-width', '1.5');
                    svg.appendChild(stripe);
                }
            }

            if (rank.arc) {
                const arc = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                arc.setAttribute('d', 'M 23,68 Q 40,58 57,68');
                arc.setAttribute('fill', 'none');
                arc.setAttribute('stroke', '#f4b942');
                arc.setAttribute('stroke-width', '4');
                svg.appendChild(arc);
            }

            if (rank.rockers) {
                const baseRockerY = 70;
                for (let i = 0; i < rank.rockers; i++) {
                    const y = baseRockerY + (i * 5);
                    const rocker = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    rocker.setAttribute('d', `M 20,${y} Q 40,${y+4} 60,${y}`);
                    rocker.setAttribute('fill', 'none');
                    rocker.setAttribute('stroke', '#f4b942');
                    rocker.setAttribute('stroke-width', '3.5');
                    svg.appendChild(rocker);
                }
            }

            if (rank.diamond) {
                const diamond = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                diamond.setAttribute('points', '40,15 46,25 40,35 34,25');
                diamond.setAttribute('fill', '#f4b942');
                diamond.setAttribute('stroke', '#1e3c72');
                diamond.setAttribute('stroke-width', '1.5');
                svg.appendChild(diamond);
            }

            if (rank.star) {
                const star = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                const starPoints = [];
                for (let i = 0; i < 5; i++) {
                    const angle = (i * 4 * Math.PI) / 5 - Math.PI / 2;
                    const x = 40 + 8 * Math.cos(angle);
                    const y = 25 + 8 * Math.sin(angle);
                    starPoints.push(`${x},${y}`);
                }
                star.setAttribute('points', starPoints.join(' '));
                star.setAttribute('fill', '#f4b942');
                star.setAttribute('stroke', '#1e3c72');
                star.setAttribute('stroke-width', '1');
                svg.appendChild(star);
            }

            if (rank.seal) {
                // Extra outer wreath for Sergeant Major of the Army
                const outerWreath = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                outerWreath.setAttribute('cx', '40');
                outerWreath.setAttribute('cy', '25');
                outerWreath.setAttribute('r', '15');
                outerWreath.setAttribute('fill', 'none');
                outerWreath.setAttribute('stroke', '#6b8e23');
                outerWreath.setAttribute('stroke-width', '2.5');
                outerWreath.setAttribute('stroke-dasharray', '3,2');
                svg.appendChild(outerWreath);
                
                // Army star in center
                const centerStar = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                const centerPoints = [];
                for (let i = 0; i < 5; i++) {
                    const angle = (i * 4 * Math.PI) / 5 - Math.PI / 2;
                    const x = 40 + 5 * Math.cos(angle);
                    const y = 25 + 5 * Math.sin(angle);
                    centerPoints.push(`${x},${y}`);
                }
                centerStar.setAttribute('points', centerPoints.join(' '));
                centerStar.setAttribute('fill', '#f4b942');
                centerStar.setAttribute('stroke', '#1e3c72');
                centerStar.setAttribute('stroke-width', '0.5');
                svg.appendChild(centerStar);
            }

            if (rank.wreath) {
                const wreath = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                wreath.setAttribute('cx', '40');
                wreath.setAttribute('cy', '25');
                wreath.setAttribute('r', '12');
                wreath.setAttribute('fill', 'none');
                wreath.setAttribute('stroke', '#6b8e23');
                wreath.setAttribute('stroke-width', '2');
                wreath.setAttribute('stroke-dasharray', '2,2');
                svg.appendChild(wreath);
            }

            return svg;
        }

        function populateSelect() {
            const select = document.getElementById('bracketSelect');
            select.innerHTML = '';
            
            brackets.forEach((bracket, index) => {
                const option = document.createElement('option');
                option.value = index;
                
                const tempDiv = document.createElement('div');
                tempDiv.appendChild(drawRankInsignia(ranks[bracket.rank], 30));
                
                option.textContent = ranks[bracket.rank].name;
                select.appendChild(option);
            });
        }

        function addTask() {
            const input = document.getElementById('taskInput');
            const select = document.getElementById('bracketSelect');
            const text = input.value.trim();
            const bracketIndex = parseInt(select.value);

            if (!text) return;

            brackets[bracketIndex].tasks.push({ text, completed: false });
            input.value = '';
            saveData();
            render();
        }

        function deleteTask(bracketIndex, taskIndex) {
            if (confirm('Delete this task?')) {
                brackets[bracketIndex].tasks.splice(taskIndex, 1);
                checkBracketCompletion(bracketIndex);
                saveData();
                render();
            }
        }

        function moveTaskUp(bracketIndex, taskIndex) {
            if (taskIndex > 0) {
                const temp = brackets[bracketIndex].tasks[taskIndex];
                brackets[bracketIndex].tasks[taskIndex] = brackets[bracketIndex].tasks[taskIndex - 1];
                brackets[bracketIndex].tasks[taskIndex - 1] = temp;
                saveData();
                render();
            }
        }

        function moveTaskDown(bracketIndex, taskIndex) {
            if (taskIndex < brackets[bracketIndex].tasks.length - 1) {
                const temp = brackets[bracketIndex].tasks[taskIndex];
                brackets[bracketIndex].tasks[taskIndex] = brackets[bracketIndex].tasks[taskIndex + 1];
                brackets[bracketIndex].tasks[taskIndex + 1] = temp;
                saveData();
                render();
            }
        }

        function openEditModal(bracketIndex, taskIndex) {
            editingTask = { bracketIndex, taskIndex };
            const task = brackets[bracketIndex].tasks[taskIndex];
            document.getElementById('editInput').value = task.text;
            document.getElementById('editModal').style.display = 'flex';
        }

        function cancelEdit() {
            editingTask = null;
            document.getElementById('editModal').style.display = 'none';
        }

        function saveEdit() {
            if (editingTask) {
                const newText = document.getElementById('editInput').value.trim();
                if (newText) {
                    brackets[editingTask.bracketIndex].tasks[editingTask.taskIndex].text = newText;
                    saveData();
                    render();
                }
                cancelEdit();
            }
        }

        function openMoveModal(bracketIndex, taskIndex) {
            movingTask = { bracketIndex, taskIndex };
            
            const select = document.getElementById('moveBracketSelect');
            select.innerHTML = '';
            
            brackets.forEach((bracket, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = ranks[bracket.rank].name;
                if (index === bracketIndex) {
                    option.textContent += ' (current)';
                }
                select.appendChild(option);
            });
            
            select.value = bracketIndex;
            document.getElementById('moveModal').style.display = 'flex';
        }

        function cancelMove() {
            movingTask = null;
            document.getElementById('moveModal').style.display = 'none';
        }

        function saveMove() {
            if (movingTask) {
                const targetBracket = parseInt(document.getElementById('moveBracketSelect').value);
                
                if (targetBracket !== movingTask.bracketIndex) {
                    const task = brackets[movingTask.bracketIndex].tasks[movingTask.taskIndex];
                    brackets[movingTask.bracketIndex].tasks.splice(movingTask.taskIndex, 1);
                    brackets[targetBracket].tasks.push(task);
                    
                    checkBracketCompletion(movingTask.bracketIndex);
                    checkBracketCompletion(targetBracket);
                    
                    saveData();
                    render();
                }
                cancelMove();
            }
        }

        function toggleTask(bracketIndex, taskIndex) {
            brackets[bracketIndex].tasks[taskIndex].completed = !brackets[bracketIndex].tasks[taskIndex].completed;
            checkBracketCompletion(bracketIndex);
            saveData();
            render();
        }

        function checkBracketCompletion(bracketIndex) {
            const bracket = brackets[bracketIndex];
            const allCompleted = bracket.tasks.length > 0 && bracket.tasks.every(t => t.completed);
            
            if (allCompleted && !bracket.completed) {
                bracket.completed = true;
                checkRankUp();
            }
        }

        function checkRankUp() {
            const completedBrackets = brackets.filter(b => b.completed).length;
            
            if (completedBrackets > currentRank) {
                currentRank = completedBrackets;
                showRankUp(currentRank);
            }
        }

        function showRankUp(rankIndex) {
            const animation = document.getElementById('rankUpAnimation');
            const rankText = document.getElementById('newRankName');
            const insigniaContainer = document.getElementById('newRankInsignia');
            
            rankText.textContent = ranks[rankIndex].name;
            insigniaContainer.innerHTML = '';
            insigniaContainer.appendChild(drawRankInsignia(ranks[rankIndex]));
            
            animation.style.display = 'flex';
        }

        function closeRankUp() {
            document.getElementById('rankUpAnimation').style.display = 'none';
        }

        function render() {
            const container = document.getElementById('bracketsContainer');
            const completedBrackets = brackets.filter(b => b.completed).length;
            
            const rankDisplay = document.getElementById('rankDisplay');
            rankDisplay.innerHTML = '';
            rankDisplay.appendChild(drawRankInsignia(ranks[currentRank]));
            
            const rankName = document.createElement('div');
            rankName.textContent = ranks[currentRank].name;
            rankName.style.fontSize = '28px';
            rankName.style.fontWeight = 'bold';
            rankName.style.textShadow = '2px 2px 4px rgba(0,0,0,0.8)';
            rankDisplay.appendChild(rankName);
            
            const progress = document.createElement('div');
            progress.className = 'rank-progress';
            progress.textContent = `${completedBrackets}/${brackets.length} brackets completed`;
            rankDisplay.appendChild(progress);

            container.innerHTML = brackets.map((bracket, bIndex) => {
                const insigniaDiv = document.createElement('div');
                insigniaDiv.appendChild(drawRankInsignia(ranks[bracket.rank], 40));
                
                return `
                <div class="bracket-section">
                    <div class="bracket-header">
                        <div class="bracket-title">
                            <div id="bracket-insignia-${bIndex}"></div>
                            <span>${ranks[bracket.rank].name}</span>
                        </div>
                        <span class="bracket-progress">
                            ${bracket.tasks.filter(t => t.completed).length}/${bracket.tasks.length} tasks
                            ${bracket.completed ? '✓' : ''}
                        </span>
                    </div>
                    <ul class="task-list">
                        ${bracket.tasks.map((task, tIndex) => `
                            <li class="task-item ${task.completed ? 'completed' : ''}">
                                <input type="checkbox" class="task-checkbox" 
                                    ${task.completed ? 'checked' : ''} 
                                    onchange="toggleTask(${bIndex}, ${tIndex})">
                                <span class="task-text">${task.text}</span>
                                <div class="task-controls">
                                    <button class="arrow-btn" onclick="moveTaskUp(${bIndex}, ${tIndex})" 
                                        ${tIndex === 0 ? 'disabled' : ''}>▲</button>
                                    <button class="arrow-btn" onclick="moveTaskDown(${bIndex}, ${tIndex})" 
                                        ${tIndex === bracket.tasks.length - 1 ? 'disabled' : ''}>▼</button>
                                    <button class="edit-btn" onclick="openEditModal(${bIndex}, ${tIndex})">Edit</button>
                                    <button class="move-btn" onclick="openMoveModal(${bIndex}, ${tIndex})">Move</button>
                                    <button class="delete-btn" onclick="deleteTask(${bIndex}, ${tIndex})">Delete</button>
                                </div>
                            </li>
                        `).join('')}
                    </ul>
                </div>
                `;
            }).join('');
            
            brackets.forEach((bracket, bIndex) => {
                const insigniaContainer = document.getElementById(`bracket-insignia-${bIndex}`);
                if (insigniaContainer) {
                    insigniaContainer.appendChild(drawRankInsignia(ranks[bracket.rank], 40));
                }
            });
        }

        loadData();
        populateSelect();
        render();
    </script>
</body>
</html>
