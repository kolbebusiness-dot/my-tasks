<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Task Rank System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: repeating-linear-gradient(45deg, #3d4a3e, #3d4a3e 10px, #4a5a4b 10px, #4a5a4b 20px, #5a6b5c 20px, #5a6b5c 30px, #4a5548 30px, #4a5548 40px);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: rgba(42, 48, 42, 0.95);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            border: 3px solid #5a6b5c;
        }
        h1 {
            text-align: center;
            color: #d4af37;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        .rank-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #3d4a3e 0%, #5a6b5c 100%);
            border-radius: 8px;
            margin-bottom: 30px;
            color: #d4af37;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            border: 2px solid #7a8b7c;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .rank-progress { font-size: 14px; opacity: 0.9; color: #c4c4c4; }
        .rank-insignia { width: 80px; height: 80px; filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.8)); }
        .input-section { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
        .input-row { display: flex; gap: 10px; }
        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 2px solid #5a6b5c;
            border-radius: 6px;
            font-size: 16px;
            background: rgba(240, 240, 240, 0.95);
        }
        input[type="text"]:focus { outline: none; border-color: #d4af37; }
        select {
            padding: 12px;
            border: 2px solid #5a6b5c;
            border-radius: 6px;
            font-size: 16px;
            background: rgba(240, 240, 240, 0.95);
            cursor: pointer;
            width: 100%;
        }
        button {
            padding: 12px 24px;
            background: #5a6b5c;
            color: #f4f4f4;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
        }
        button:hover { background: #4a5a4b; }
        .reset-btn { background: #8b4513; margin-top: 10px; width: 100%; }
        .reset-btn:hover { background: #6b3410; }
        .reset-progress-btn { background: #cd853f; margin-top: 10px; width: 100%; }
        .reset-progress-btn:hover { background: #b8732e; }
        .bracket-section { margin-bottom: 25px; }
        .bracket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: linear-gradient(135deg, #4a5548 0%, #5a6b5c 100%);
            border-radius: 6px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #d4af37;
            gap: 10px;
            border: 2px solid #3d4a3e;
        }
        .bracket-title { display: flex; align-items: center; gap: 10px; }
        .bracket-insignia { width: 40px; height: 40px; filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.8)); }
        .bracket-progress { font-size: 14px; color: #c4c4c4; }
        .task-list { list-style: none; }
        .task-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: rgba(90, 107, 92, 0.3);
            border-radius: 6px;
            margin-bottom: 8px;
            border: 1px solid #5a6b5c;
        }
        .task-item.completed { opacity: 0.5; text-decoration: line-through; }
        .task-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            flex-shrink: 0;
            accent-color: #d4af37;
        }
        .task-text {
            flex: 1;
            color: #e4e4e4;
            cursor: text;
            padding: 4px;
            border-radius: 4px;
            min-width: 0;
            word-break: break-word;
        }
        .task-text:hover { background: rgba(255, 255, 255, 0.1); }
        .task-text.editing {
            background: rgba(240, 240, 240, 0.95);
            color: #2a302a;
            outline: 2px solid #d4af37;
        }
        .task-controls { display: flex; gap: 5px; margin-left: 10px; flex-shrink: 0; }
        .arrow-btn, .move-btn, .delete-btn {
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        .arrow-btn { background: #5a6b5c; }
        .arrow-btn:hover { background: #4a5a4b; }
        .arrow-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .move-btn { background: #5a6b5c; font-size: 16px; }
        .move-btn:hover { background: #4a5a4b; }
        .delete-btn { background: #8b4513; font-size: 16px; }
        .delete-btn:hover { background: #6b3410; }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal-content {
            background: #2a302a;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            border: 3px solid #5a6b5c;
        }
        .modal-content h3 { color: #d4af37; margin-bottom: 20px; text-align: center; }
        .modal-content select {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #5a6b5c;
            border-radius: 6px;
            font-size: 16px;
            background: rgba(240, 240, 240, 0.95);
        }
        .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; }
        .modal-buttons button { padding: 10px 20px; }
        .rank-up-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(42, 48, 42, 0.98);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .rank-up-content { text-align: center; color: #d4af37; }
        .rank-up-content h2 {
            font-size: 48px;
            margin-bottom: 20px;
            text-transform: uppercase;
            color: #d4af37;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
        }
        .rank-up-content p { font-size: 24px; margin-bottom: 30px; color: #e4e4e4; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Task Rank System</h1>
        <div class="rank-display" id="rankDisplay"></div>
        <div class="input-section">
            <div class="input-row">
                <input type="text" id="taskInput" placeholder="Enter task...">
                <button onclick="addTask()">Add</button>
            </div>
            <select id="bracketSelect"></select>
            <button class="reset-progress-btn" onclick="resetProgress()">Reset Progress</button>
            <button class="reset-btn" onclick="resetAll()">Reset All Data</button>
        </div>
        <div id="bracketsContainer"></div>
    </div>
    <div class="rank-up-animation" id="rankUpAnimation">
        <div class="rank-up-content">
            <div id="newRankInsignia"></div>
            <h2>RANK UP!</h2>
            <p id="newRankName"></p>
            <button onclick="closeRankUp()">Continue</button>
        </div>
    </div>
    <div class="modal" id="moveModal">
        <div class="modal-content">
            <h3>Move Task To</h3>
            <select id="moveBracketSelect"></select>
            <div class="modal-buttons">
                <button onclick="cancelMove()">Cancel</button>
                <button onclick="saveMove()">Move</button>
            </div>
        </div>
    </div>
    <script>
        const ranks = [
            { name: 'No Insignia', stripes: 0 },
            { name: 'Private', stripes: 1 },
            { name: 'Private First Class', stripes: 1, arc: true },
            { name: 'Specialist', stripes: 0, eagle: true },
            { name: 'Corporal', stripes: 2 },
            { name: 'Sergeant', stripes: 3 },
            { name: 'Staff Sergeant', stripes: 3, rockers: 1 },
            { name: 'Sergeant First Class', stripes: 3, rockers: 2 },
            { name: 'Master Sergeant', stripes: 3, rockers: 3 },
            { name: 'First Sergeant', stripes: 3, rockers: 3, diamond: true },
            { name: 'Sergeant Major', stripes: 3, rockers: 3, star: true },
            { name: 'Command Sergeant Major', stripes: 3, rockers: 3, star: true, wreath: true },
            { name: 'Sergeant Major of the Army', stripes: 3, rockers: 3, star: true, wreath: true, seal: true }
        ];
        let brackets = Array.from({length:12}, (_,i) => ({ name: `Bracket ${i+1}`, rank: i+1, tasks: [], completed: false }));
        let currentRank = 0, movingTask = null;

        function saveData() { localStorage.setItem('taskRanksData', JSON.stringify({ brackets, currentRank })); }
        function loadData() {
            const saved = localStorage.getItem('taskRanksData');
            if (saved) { const data = JSON.parse(saved); brackets = data.brackets; currentRank = data.currentRank; }
        }

        function resetProgress() {
            if (confirm('Reset all progress? This will uncheck all tasks and reset your rank, but keep all tasks.')) {
                brackets.forEach(b => { b.tasks.forEach(t => t.completed = false); b.completed = false; });
                currentRank = 0; saveData(); render();
            }
        }

        function resetAll() {
            if (confirm('Delete ALL tasks and reset rank? This cannot be undone.')) {
                localStorage.removeItem('taskRanksData');
                brackets = Array.from({length:12}, (_,i) => ({ name: `Bracket ${i+1}`, rank: i+1, tasks: [], completed: false }));
                currentRank = 0; render();
            }
        }

        function drawRankInsignia(rank, size = 80) {
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', size); svg.setAttribute('height', size); svg.setAttribute('viewBox', '0 0 80 80');
            if (size === 80) svg.classList.add('rank-insignia');
            else if (size === 40) svg.classList.add('bracket-insignia');
            if (rank.name === 'No Insignia') return svg;

            if (rank.eagle) {
                const shield = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                shield.setAttribute('d', 'M 40,20 L 30,25 L 25,40 L 30,55 L 40,60 L 50,55 L 55,40 L 50,25 Z');
                shield.setAttribute('fill', '#1e3c72'); shield.setAttribute('stroke', '#f4b942'); shield.setAttribute('stroke-width', '2');
                svg.appendChild(shield);
                const eagle = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                eagle.setAttribute('d', 'M 32,35 L 40,30 L 48,35 M 35,38 L 40,42 L 45,38 M 30,40 L 35,42 M 50,40 L 45,42');
                eagle.setAttribute('stroke', '#f4b942'); eagle.setAttribute('stroke-width', '2'); eagle.setAttribute('fill', 'none');
                svg.appendChild(eagle);
                return svg;
            }

            if (rank.stripes) {
                for (let i = 0; i < rank.stripes; i++) {
                    const y = 65 - i * 11;
                    const stripe = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                    stripe.setAttribute('points', `20,${y} 40,${y-12} 60,${y} 60,${y+8} 40,${y-4} 20,${y+8}`);
                    stripe.setAttribute('fill', '#f4b942'); stripe.setAttribute('stroke', '#1e3c72'); stripe.setAttribute('stroke-width', '1.5');
                    svg.appendChild(stripe);
                }
            }
            if (rank.arc) {
                const arc = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                arc.setAttribute('d', 'M 23,68 Q 40,58 57,68'); arc.setAttribute('fill', 'none');
                arc.setAttribute('stroke', '#f4b942'); arc.setAttribute('stroke-width', '4');
                svg.appendChild(arc);
            }
            if (rank.rockers) {
                for (let i = 0; i < rank.rockers; i++) {
                    const rocker = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    rocker.setAttribute('d', `M 20,${70 + i*5} Q 40,${74 + i*5} 60,${70 + i*5}`);
                    rocker.setAttribute('fill', 'none'); rocker.setAttribute('stroke', '#f4b942'); rocker.setAttribute('stroke-width', '3.5');
                    svg.appendChild(rocker);
                }
            }
            if (rank.diamond) {
                const diamond = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                diamond.setAttribute('points', '40,15 46,25 40,35 34,25');
                diamond.setAttribute('fill', '#f4b942'); diamond.setAttribute('stroke', '#1e3c72'); diamond.setAttribute('stroke-width', '1.5');
                svg.appendChild(diamond);
            }
            if (rank.star) {
                const star = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                const pts = []; for (let i = 0; i < 5; i++) { const a = i*4*Math.PI/5 - Math.PI/2; pts.push(`${40+8*Math.cos(a)},${25+8*Math.sin(a)}`); }
                star.setAttribute('points', pts.join(' ')); star.setAttribute('fill', '#f4b942'); star.setAttribute('stroke', '#1e3c72'); star.setAttribute('stroke-width', '1');
                svg.appendChild(star);
            }
            if (rank.seal) {
                const w = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                w.setAttribute('cx', '40'); w.setAttribute('cy', '25'); w.setAttribute('r', '15');
                w.setAttribute('fill', 'none'); w.setAttribute('stroke', '#6b8e23'); w.setAttribute('stroke-width', '2.5'); w.setAttribute('stroke-dasharray', '3,2');
                svg.appendChild(w);
                const s = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                const p = []; for (let i = 0; i < 5; i++) { const a = i*4*Math.PI/5 - Math.PI/2; p.push(`${40+5*Math.cos(a)},${25+5*Math.sin(a)}`); }
                s.setAttribute('points', p.join(' ')); s.setAttribute('fill', '#f4b942'); s.setAttribute('stroke', '#1e3c72'); s.setAttribute('stroke-width', '0.5');
                svg.appendChild(s);
            }
            if (rank.wreath) {
                const w = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                w.setAttribute('cx', '40'); w.setAttribute('cy', '25'); w.setAttribute('r', '12');
                w.setAttribute('fill', 'none'); w.setAttribute('stroke', '#6b8e23'); w.setAttribute('stroke-width', '2'); w.setAttribute('stroke-dasharray', '2,2');
                svg.appendChild(w);
            }
            return svg;
        }

        function populateSelect() {
            const s = document.getElementById('bracketSelect');
            s.innerHTML = ''; brackets.forEach((b, i) => { const o = document.createElement('option'); o.value = i; o.textContent = ranks[b.rank].name; s.appendChild(o); });
        }

        function addTask() {
            const i = document.getElementById('taskInput'), s = document.getElementById('bracketSelect'), t = i.value.trim(), bi = parseInt(s.value);
            if (!t) return; brackets[bi].tasks.push({ text: t, completed: false }); i.value = ''; saveData(); render();
        }

        function deleteTask(bi, ti) { if (confirm('Delete this task?')) { brackets[bi].tasks.splice(ti, 1); checkBracketCompletion(bi); saveData(); render(); } }
        function moveTaskUp(bi, ti) {
            if (ti > 0) { [brackets[bi].tasks[ti], brackets[bi].tasks[ti-1]] = [brackets[bi].tasks[ti-1], brackets[bi].tasks[ti]]; }
            saveData(); render();
        }
        function moveTaskDown(bi, ti) {
            if (ti < brackets[bi].tasks.length - 1) { [brackets[bi].tasks[ti], brackets[bi].tasks[ti+1]] = [brackets[bi].tasks[ti+1], brackets[bi].tasks[ti]]; }
            saveData(); render();
        }

        function openMoveModal(bi, ti) {
            movingTask = { bracketIndex: bi, taskIndex: ti };
            const s = document.getElementById('moveBracketSelect'); s.innerHTML = '';
            brackets.forEach((b, i) => { const o = document.createElement('option'); o.value = i; o.textContent = ranks[b.rank].name + (i === bi ? ' (current)' : ''); s.appendChild(o); });
            s.value = bi; document.getElementById('moveModal').style.display = 'flex';
        }
        function cancelMove() { movingTask = null; document.getElementById('moveModal').style.display = 'none'; }
        function saveMove() {
            if (movingTask) {
                const tb = parseInt(document.getElementById('moveBracketSelect').value);
                if (tb !== movingTask.bracketIndex) {
                    const t = brackets[movingTask.bracketIndex].tasks[movingTask.taskIndex];
                    brackets[movingTask.bracketIndex].tasks.splice(movingTask.taskIndex, 1);
                    brackets[tb].tasks.push(t);
                    checkBracketCompletion(movingTask.bracketIndex); checkBracketCompletion(tb);
                    saveData(); render();
                }
                cancelMove();
            }
        }

        function editTaskText(e, bi, ti) {
            e.stopPropagation();
            const s = e.target, ct = brackets[bi].tasks[ti].text;
            s.contentEditable = true; s.classList.add('editing'); s.focus();
            const r = document.createRange(); r.selectNodeContents(s);
            const sel = window.getSelection(); sel.removeAllRanges(); sel.addRange(r);
            const save = () => {
                const nt = s.textContent.trim();
                s.contentEditable = false; s.classList.remove('editing');
                if (nt && nt !== ct) { brackets[bi].tasks[ti].text = nt; saveData(); render(); } else { s.textContent = ct; }
            };
            const hb = () => save();
            const hk = (ev) => {
                if (ev.key === 'Enter') { ev.preventDefault(); s.blur(); }
                else if (ev.key === 'Escape') { s.textContent = ct; s.contentEditable = false; s.classList.remove('editing'); s.removeEventListener('blur', hb); s.removeEventListener('keydown', hk); }
            };
            s.addEventListener('blur', hb, { once: true }); s.addEventListener('keydown', hk);
        }

        function toggleTask(bi, ti) { brackets[bi].tasks[ti].completed = !brackets[bi].tasks[ti].completed; checkBracketCompletion(bi); saveData(); render(); }
        function checkBracketCompletion(bi) {
            const b = brackets[bi], ac = b.tasks.length > 0 && b.tasks.every(t => t.completed);
            if (ac && !b.completed) { b.completed = true; checkRankUp(); }
        }
        function checkRankUp() {
            const cb = brackets.filter(b => b.completed).length;
            if (cb > currentRank) { currentRank = cb; showRankUp(currentRank); }
        }
        function showRankUp(ri) {
            const a = document.getElementById('rankUpAnimation'), rn = document.getElementById('newRankName'), ic = document.getElementById('newRankInsignia');
            rn.textContent = ranks[ri].name; ic.innerHTML = ''; ic.appendChild(drawRankInsignia(ranks[ri]));
            a.style.display = 'flex';
        }
        function closeRankUp() { document.getElementById('rankUpAnimation').style.display = 'none'; }

        function render() {
            const c = document.getElementById('bracketsContainer'), cb = brackets.filter(b => b.completed).length;
            const rd = document.getElementById('rankDisplay'); rd.innerHTML = ''; rd.appendChild(drawRankInsignia(ranks[currentRank]));
            const rn = document.createElement('div'); rn.textContent = ranks[currentRank].name; rn.style.fontSize = '28px'; rn.style.fontWeight = 'bold'; rn.style.textShadow = '2px 2px 4px rgba(0,0,0,0.8)'; rd.appendChild(rn);
            const p = document.createElement('div'); p.className = 'rank-progress'; p.textContent = `${cb}/${brackets.length} brackets completed`; rd.appendChild(p);

            c.innerHTML = brackets.map((b, bi) => `
                <div class="bracket-section">
                    <div class="bracket-header">
                        <div class="bracket-title"><div id="bracket-insignia-${bi}"></div><span>${ranks[b.rank].name}</span></div>
                        <span class="bracket-progress">${b.tasks.filter(t => t.completed).length}/${b.tasks.length} tasks ${b.completed ? '✓' : ''}</span>
                    </div>
                    <ul class="task-list">
                        ${b.tasks.map((t, ti) => `
                            <li class="task-item ${t.completed ? 'completed' : ''}">
                                <input type="checkbox" class="task-checkbox" ${t.completed ? 'checked' : ''} onchange="toggleTask(${bi}, ${ti})">
                                <span class="task-text" onclick="editTaskText(event, ${bi}, ${ti})">${t.text}</span>
                                <div class="task-controls">
                                    <button class="arrow-btn" onclick="moveTaskUp(${bi}, ${ti})" ${ti === 0 ? 'disabled' : ''}>▲</button>
                                    <button class="arrow-btn" onclick="moveTaskDown(${bi}, ${ti})" ${ti === b.tasks.length - 1 ? 'disabled' : ''}>▼</button>
                                    <button class="move-btn" onclick="openMoveModal(${bi}, ${ti})">⇅</button>
                                    <button class="delete-btn" onclick="deleteTask(${bi}, ${ti})">×</button>
                                </div>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');
            
            brackets.forEach((b, bi) => {
                const ic = document.getElementById(`bracket-insignia-${bi}`);
                if (ic) ic.appendChild(drawRankInsignia(ranks[b.rank], 40));
            });
        }

        loadData(); populateSelect(); render();
    </script>
</body>
</html>
